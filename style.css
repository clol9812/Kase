// Ð”Ð¾Ð¿Ð¾Ð»Ð½ÑÐµÐ¼ Ð¾Ð±ÑŠÐµÐºÑ‚ Case
const cases = [
    {
        id: 1,
        name: "ÐžÐ±Ñ‹Ñ‡Ð½Ñ‹Ð¹ ÐºÐµÐ¹Ñ",
        price: 100,
        image: "./images/case1.png",
        items: [
            // Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð¿Ð¾Ð»Ðµ animationImage Ð´Ð»Ñ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ð¸
            { name: "ÐŸÐ¸ÑÑ‚Ð¾Ð»ÐµÑ‚", price: 50, rare: 1, 
              image: "./images/pistol.png", 
              animationImage: "./images/pistol_spin.gif" },
            // ... Ð¾ÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¿Ñ€ÐµÐ´Ð¼ÐµÑ‚Ñ‹
        ]
    },
    // ... Ð¾ÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ ÐºÐµÐ¹ÑÑ‹
];

let isSpinning = false;
let spinTimeout;

async function openCase(caseId) {
    if (isSpinning) return;
    
    const selectedCase = cases.find(c => c.id === caseId);
    if (!selectedCase || balance < selectedCase.price) {
        showError("ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ ÑÑ€ÐµÐ´ÑÑ‚Ð²!");
        return;
    }

    isSpinning = true;
    balance -= selectedCase.price;
    updateBalance();

    // Ð¡Ð»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ð¹ Ð¿Ñ€ÐµÐ´Ð¼ÐµÑ‚
    const items = selectedCase.items;
    const targetIndex = Math.floor(Math.random() * items.length);
    const targetItem = items[targetIndex];

    // Ð—Ð°Ð¿ÑƒÑÐº Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ð¸
    await startSlotAnimation(items, targetIndex);
    
    // ÐŸÐ¾ÐºÐ°Ð· Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð°
    showResult(targetItem);
    
    // Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð² Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€ÑŒ
    inventory.push(targetItem);
    updateInventory();
    isSpinning = false;
}

async function startSlotAnimation(items, targetIndex) {
    const slot = document.getElementById('slotItems');
    slot.innerHTML = '';
    
    // Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ 20 ÐºÐ»Ð¾Ð½Ð¾Ð² Ð¿Ñ€ÐµÐ´Ð¼ÐµÑ‚Ð¾Ð² Ð´Ð»Ñ ÑÑ„Ñ„ÐµÐºÑ‚Ð° Ð±ÐµÑÐºÐ¾Ð½ÐµÑ‡Ð½Ð¾Ð³Ð¾ Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ñ
    const spinItems = [...items, ...items, ...items, ...items, ...items];
    
    spinItems.forEach((item, index) => {
        const div = document.createElement('div');
        div.className = 'slot-item';
        div.innerHTML = `
            <img src="${item.animationImage || item.image}" 
                 alt="${item.name}"
                 class="${index === targetIndex ? 'target-item' : ''}">
        `;
        slot.appendChild(div);
    });

    // ÐÐ°Ñ‡Ð°Ð»Ð¾ Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ð¸
    slot.style.transition = 'none';
    slot.style.transform = 'translateY(0)';
    
    await new Promise(resolve => setTimeout(resolve, 50));
    
    // Ð—Ð°Ð¿ÑƒÑÐº Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¸Ñ
    slot.style.transition = 'transform 3s cubic-bezier(0.25, 0.1, 0.25, 1)';
    slot.style.transform = `translateY(-${(targetIndex + spinItems.length * 2) * 200}px)`;
    
    // Ð’Ð¸Ð±Ñ€Ð°Ñ†Ð¸Ñ (Ð´Ð»Ñ Ð¼Ð¾Ð±Ð¸Ð»ÑŒÐ½Ñ‹Ñ…)
    if (navigator.vibrate) navigator.vibrate([200, 100, 200]);
    
    return new Promise(resolve => {
        slot.ontransitionend = () => resolve();
    });
}

function showResult(item) {
    const slot = document.getElementById('slotItems');
    slot.innerHTML = `
        <div class="slot-item">
            <img src="${item.image}" 
                 alt="${item.name}"
                 class="winning-animation"
                 style="transform: scale(1.2)">
        </div>
    `;
    
    // Ð­Ñ„Ñ„ÐµÐºÑ‚ ÐºÐ¾Ð½Ñ„ÐµÑ‚Ñ‚Ð¸
    for(let i = 0; i < 50; i++) {
        createConfetti();
    }
    
    // Ð’ÑÐ¿Ð»Ñ‹Ð²Ð°ÑŽÑ‰ÐµÐµ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ
    const notification = document.createElement('div');
    notification.className = 'win-notification';
    notification.innerHTML = `
        ðŸŽ‰ ${item.name} ($${item.price}) ðŸŽ‰
    `;
    document.body.appendChild(notification);
    
    setTimeout(() => notification.remove(), 3000);
}

// Ð­Ñ„Ñ„ÐµÐºÑ‚ ÐºÐ¾Ð½Ñ„ÐµÑ‚Ñ‚Ð¸
function createConfetti() {
    const confetti = document.createElement('div');
    confetti.className = 'confetti';
    confetti.style.left = Math.random() * 100 + '%';
    confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
    document.body.appendChild(confetti);
    
    setTimeout(() => confetti.remove(), 3000);
        }
